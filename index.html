<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Northwest Service Centers | Southeast US</title>
  <style>
/* ==========================================================================
   brands.css — Northwest "Disney + Neon Glass" map theme + brand territories
   ========================================================================== */

/* ---------- Global Theme Tokens ---------- */
:root{
  /* Background + glass */
  --bg-0: #05070a;
  --bg-1: #061019;
  --glass: rgba(255,255,255,.08);
  --glass-2: rgba(255,255,255,.12);
  --stroke: rgba(255,255,255,.18);
  --stroke-strong: rgba(255,255,255,.28);

  /* Text */
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.68);
  --faint: rgba(255,255,255,.48);

  /* Neon accents */
  --glow: rgba(133, 196, 70, .55);
  --shadow: 0 12px 50px rgba(0,0,0,.55);
  --blur: 14px;

  /* Marker */
  --marker-size: 10px;
  --marker-ring: 22px;

  /* Territory */
  --territory-opacity: .42;
  --territory-edge-softness: 18px;
  --overlap-band-width: 16px;
  --stripe-angle: 28deg;
  --stripe-width: 10px;
  --stripe-opacity: .55;

  /* Brand Colors */
  --brand-northwest: #85c446;
  --brand-carolina:  #0399d6;
  --brand-sawyer:    #ec2024;
  --brand-bughouse:  #7c2529;
  --brand-mccall:    #ffb703;
  --brand-volunteer: #ee8c02;

  /* Fallback */
  --brand-default: var(--brand-northwest);
}

/* ---------- Page + Layout ---------- */
html, body {
  height: 100%;
  margin: 0;
  color: var(--text);
  background: radial-gradient(1200px 700px at 20% 10%, rgba(133,196,70,.12), transparent 60%),
              radial-gradient(900px 650px at 85% 30%, rgba(45,212,191,.10), transparent 55%),
              linear-gradient(160deg, var(--bg-0), var(--bg-1));
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
}

/* ---------- Header ---------- */
.header {
  padding: 16px 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid rgba(255,255,255,.08);
}
.header h1 {
  font-size: 1.25rem;
  font-weight: 600;
  letter-spacing: -0.01em;
}
.header .subtitle {
  font-size: 0.85rem;
  color: var(--muted);
}

/* ---------- Map Stage ---------- */
.map-stage{
  position: relative;
  width: 100%;
  height: min(78vh, 860px);
  border-radius: 22px;
  overflow: hidden;
  box-shadow: var(--shadow);
  border: 1px solid rgba(255,255,255,.10);
  background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  margin: 16px;
  width: calc(100% - 32px);
}

/* Canvas territory layer */
#territoryCanvas{
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  opacity: var(--territory-opacity);
  pointer-events: none;
  mix-blend-mode: screen;
  filter: saturate(1.25) contrast(1.05);
}

/* SVG map outline layer */
#seMapSvg{
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  opacity: .85;
}
#seMapSvg path{
  fill: rgba(255,255,255,.035);
  stroke: rgba(255,255,255,.16);
  stroke-width: 1.2;
  vector-effect: non-scaling-stroke;
}
#seMapSvg text {
  fill: rgba(255,255,255,.25);
  font-size: 14px;
  font-weight: 500;
}

/* Markers layer (interactive) */
.marker-layer{
  position: absolute;
  inset: 0;
  pointer-events: auto;
}

/* ---------- Markers ---------- */
.marker{
  position: absolute;
  width: var(--marker-size);
  height: var(--marker-size);
  transform: translate(-50%, -50%);
  border-radius: 999px;
  background: var(--brand-default);
  box-shadow: 0 0 0 1px rgba(0,0,0,.35),
              0 0 18px rgba(255,255,255,.10),
              0 0 22px rgba(133,196,70,.35);
  cursor: pointer;
  outline: none;
  transition: filter .18s ease, transform .18s ease;
}
.marker::before{
  content: "";
  position: absolute;
  inset: calc(var(--marker-ring) * -1);
  border-radius: 999px;
  background: radial-gradient(circle, rgba(255,255,255,.25), transparent 60%);
  opacity: 0;
  transform: scale(.9);
  transition: opacity .18s ease, transform .18s ease;
}
.marker::after{
  content: "";
  position: absolute;
  inset: -10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.16);
  opacity: .25;
}
.marker:hover::before,
.marker:focus-visible::before{
  opacity: .9;
  transform: scale(1);
}
.marker:hover,
.marker:focus-visible{
  filter: brightness(1.15) saturate(1.3);
  transform: translate(-50%, -50%) scale(1.2);
}

/* Pulse animation */
@keyframes pulseGlow {
  0%   { box-shadow: 0 0 0 1px rgba(0,0,0,.35), 0 0 14px rgba(255,255,255,.08), 0 0 22px rgba(133,196,70,.28); }
  50%  { box-shadow: 0 0 0 1px rgba(0,0,0,.35), 0 0 18px rgba(255,255,255,.12), 0 0 30px rgba(133,196,70,.44); }
  100% { box-shadow: 0 0 0 1px rgba(0,0,0,.35), 0 0 14px rgba(255,255,255,.08), 0 0 22px rgba(133,196,70,.28); }
}
.marker.is-active{
  animation: pulseGlow 1.6s ease-in-out infinite;
}

/* Dimming */
.marker.is-dim{
  opacity: .18;
  filter: grayscale(.35);
}
.marker.is-highlighted {
  transform: translate(-50%, -50%) scale(1.5);
  z-index: 100;
}

/* ---------- Tooltip ---------- */
.tooltip{
  position: absolute;
  min-width: 260px;
  max-width: 360px;
  padding: 14px 14px 12px;
  border-radius: 16px;
  background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
  border: 1px solid rgba(255,255,255,.18);
  box-shadow: 0 20px 80px rgba(0,0,0,.55);
  backdrop-filter: blur(var(--blur));
  -webkit-backdrop-filter: blur(var(--blur));
  transform: translate3d(0, 10px, 0) scale(.98);
  opacity: 0;
  pointer-events: none;
  transition: opacity .16s ease, transform .16s ease;
  z-index: 1000;
}
.tooltip.is-open{
  opacity: 1;
  transform: translate3d(0, 0, 0) scale(1);
}
.tooltip h3{
  margin: 0 0 6px 0;
  font-size: 16px;
  letter-spacing: .2px;
}
.tooltip .meta{
  font-size: 12px;
  color: var(--muted);
  line-height: 1.35;
}
.tooltip .badges{
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 10px;
}
.badge{
  font-size: 11px;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.22);
  color: var(--text);
}
.badge.brand{
  border-color: rgba(255,255,255,.18);
  box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
}

/* ---------- Controls / Filters ---------- */
.controls{
  position: absolute;
  top: 14px;
  left: 14px;
  right: 14px;
  display: flex;
  gap: 10px;
  align-items: center;
  padding: 12px;
  border-radius: 18px;
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.16);
  backdrop-filter: blur(var(--blur));
  -webkit-backdrop-filter: blur(var(--blur));
  z-index: 100;
  flex-wrap: wrap;
}
.controls input,
.controls select,
.controls button{
  height: 40px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.28);
  color: var(--text);
  padding: 0 12px;
  outline: none;
  font-size: 14px;
}
.controls input::placeholder{ color: var(--faint); }
.controls input:focus,
.controls select:focus {
  border-color: var(--brand-northwest);
  box-shadow: 0 0 0 2px rgba(133, 196, 70, 0.2);
}
.controls button{
  cursor: pointer;
  transition: transform .12s ease, filter .12s ease;
}
.controls button:hover{ transform: translateY(-1px); filter: brightness(1.1); }
.controls .spacer{ flex: 1; }

/* Search wrapper with suggestions */
.search-wrapper {
  position: relative;
  min-width: 220px;
}
.search-wrapper input {
  width: 100%;
}
.suggestions {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  margin-top: 4px;
  background: rgba(10, 15, 20, 0.95);
  border: 1px solid rgba(255,255,255,.16);
  border-radius: 12px;
  max-height: 240px;
  overflow-y: auto;
  display: none;
  backdrop-filter: blur(var(--blur));
  z-index: 200;
}
.suggestions.active { display: block; }
.suggestion-item {
  padding: 10px 12px;
  cursor: pointer;
  font-size: 13px;
  color: var(--muted);
  transition: background .12s ease;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.suggestion-item:hover,
.suggestion-item.selected {
  background: rgba(133, 196, 70, 0.15);
  color: var(--text);
}
.suggestion-item .brand-tag {
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 4px;
  opacity: 0.7;
}

/* Toggle */
.toggle-wrapper {
  display: flex;
  align-items: center;
  gap: 8px;
}
.toggle-wrapper input[type="checkbox"] {
  appearance: none;
  width: 40px;
  height: 22px;
  background: rgba(0,0,0,.4);
  border-radius: 11px;
  position: relative;
  cursor: pointer;
  border: 1px solid rgba(255,255,255,.16);
  transition: background .2s ease;
}
.toggle-wrapper input[type="checkbox"]::after {
  content: '';
  position: absolute;
  width: 16px;
  height: 16px;
  background: var(--muted);
  border-radius: 50%;
  top: 2px;
  left: 3px;
  transition: transform .2s ease, background .2s ease;
}
.toggle-wrapper input[type="checkbox"]:checked {
  background: var(--brand-northwest);
}
.toggle-wrapper input[type="checkbox"]:checked::after {
  transform: translateX(18px);
  background: var(--bg-0);
}
.toggle-wrapper span {
  font-size: 13px;
  color: var(--muted);
}

/* ---------- Legend ---------- */
.legend{
  position: absolute;
  bottom: 14px;
  left: 14px;
  display: grid;
  gap: 8px;
  padding: 12px;
  border-radius: 18px;
  background: rgba(255,255,255,.07);
  border: 1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(var(--blur));
  -webkit-backdrop-filter: blur(var(--blur));
}
.legend-item{
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 12px;
  color: var(--muted);
  cursor: pointer;
  transition: color .15s ease;
}
.legend-item:hover {
  color: var(--text);
}
.legend-swatch{
  width: 12px;
  height: 12px;
  border-radius: 4px;
  box-shadow: 0 0 16px rgba(255,255,255,.12);
  border: 1px solid rgba(255,255,255,.18);
}

/* Stats */
.stats {
  position: absolute;
  bottom: 14px;
  right: 14px;
  display: flex;
  gap: 16px;
  padding: 12px 16px;
  border-radius: 18px;
  background: rgba(255,255,255,.07);
  border: 1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(var(--blur));
}
.stat {
  text-align: center;
}
.stat-value {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--brand-northwest);
}
.stat-label {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--faint);
}

/* ---------- Brand Utility Classes ---------- */
.brand--Northwest_Exterminating { --brand-default: var(--brand-northwest); }
.brand--Carolina_Pest_Management { --brand-default: var(--brand-carolina); }
.brand--Sawyer_Exterminating { --brand-default: var(--brand-sawyer); }
.brand--Bug_House_Pest_Control { --brand-default: var(--brand-bughouse); }
.brand--McCall_Pest_and_Wildlife { --brand-default: var(--brand-mccall); }
.brand--Volunteer_Rid_A_Pest { --brand-default: var(--brand-volunteer); }

/* Apply to swatches */
.legend-swatch.brand--Northwest_Exterminating{ background: var(--brand-northwest); }
.legend-swatch.brand--Carolina_Pest_Management{ background: var(--brand-carolina); }
.legend-swatch.brand--Sawyer_Exterminating{ background: var(--brand-sawyer); }
.legend-swatch.brand--Bug_House_Pest_Control{ background: var(--brand-bughouse); }
.legend-swatch.brand--McCall_Pest_and_Wildlife{ background: var(--brand-mccall); }
.legend-swatch.brand--Volunteer_Rid_A_Pest{ background: var(--brand-volunteer); }

/* Brand tag colors */
.brand-tag.Northwest_Exterminating { background: rgba(133,196,70,.2); color: var(--brand-northwest); }
.brand-tag.Carolina_Pest_Management { background: rgba(3,153,214,.2); color: var(--brand-carolina); }
.brand-tag.Sawyer_Exterminating { background: rgba(236,32,36,.2); color: var(--brand-sawyer); }
.brand-tag.Bug_House_Pest_Control { background: rgba(124,37,41,.2); color: var(--brand-bughouse); }
.brand-tag.McCall_Pest_and_Wildlife { background: rgba(255,183,3,.2); color: var(--brand-mccall); }
.brand-tag.Volunteer_Rid_A_Pest { background: rgba(238,140,2,.2); color: var(--brand-volunteer); }

/* Badge brand colors */
.badge.Northwest_Exterminating { border-color: var(--brand-northwest); color: var(--brand-northwest); }
.badge.Carolina_Pest_Management { border-color: var(--brand-carolina); color: var(--brand-carolina); }
.badge.Sawyer_Exterminating { border-color: var(--brand-sawyer); color: var(--brand-sawyer); }
.badge.Bug_House_Pest_Control { border-color: var(--brand-bughouse); color: var(--brand-bughouse); }
.badge.McCall_Pest_and_Wildlife { border-color: var(--brand-mccall); color: var(--brand-mccall); }
.badge.Volunteer_Rid_A_Pest { border-color: var(--brand-volunteer); color: var(--brand-volunteer); }

/* ---------- Mobile adjustments ---------- */
@media (max-width: 760px){
  .map-stage{ height: 82vh; border-radius: 18px; margin: 8px; width: calc(100% - 16px); }
  .controls{ flex-wrap: wrap; padding: 10px; gap: 8px; }
  .controls input, .controls select { width: 100%; }
  .search-wrapper { width: 100%; min-width: auto; }
  .tooltip{ min-width: 220px; max-width: 320px; }
  .legend { max-width: 160px; }
  .stats { bottom: auto; top: 70px; right: 14px; flex-direction: column; gap: 8px; padding: 10px; }
}
  </style>
</head>
<body>
  <header class="header">
    <div>
      <h1>Northwest Service Centers</h1>
      <div class="subtitle">Interactive map of Southeast US locations</div>
    </div>
  </header>

  <div class="map-stage">
    <canvas id="territoryCanvas"></canvas>
    
    <svg id="seMapSvg" viewBox="0 0 1000 650" aria-hidden="true">
      <!-- Southeast US State Outlines - focused on GA, AL, TN, NC, SC, FL -->
      <g>
        <!-- Tennessee -->
        <path d="M100,50 L520,30 L540,80 L120,100 Z" data-state="TN"/>
        <!-- North Carolina -->
        <path d="M520,30 L900,10 L920,70 L880,100 L540,80 Z" data-state="NC"/>
        <!-- South Carolina -->
        <path d="M620,100 L880,100 L850,200 L720,260 L600,220 Z" data-state="SC"/>
        <!-- Georgia -->
        <path d="M380,100 L600,100 L600,220 L720,260 L700,380 L580,450 L450,450 L400,360 L380,220 Z" data-state="GA"/>
        <!-- Alabama -->
        <path d="M180,100 L380,100 L380,220 L400,360 L400,450 L220,450 L180,320 Z" data-state="AL"/>
        <!-- Florida -->
        <path d="M450,450 L580,450 L700,380 L780,420 L900,520 L850,620 L680,600 L600,640 L520,600 L480,520 Z" data-state="FL"/>
      </g>
      <!-- State Labels -->
      <g>
        <text x="300" y="75">TN</text>
        <text x="700" y="60">NC</text>
        <text x="720" y="170">SC</text>
        <text x="520" y="280">GA</text>
        <text x="290" y="280">AL</text>
        <text x="700" y="520">FL</text>
      </g>
    </svg>

    <div class="controls">
      <div class="search-wrapper">
        <input type="text" id="searchCenter" placeholder="Search service centers..." autocomplete="off">
        <div id="suggestions" class="suggestions"></div>
      </div>
      
      <select id="stateFilter">
        <option value="">All States</option>
      </select>
      
      <div class="spacer"></div>
      
      <div class="toggle-wrapper">
        <input type="checkbox" id="toggleSupport">
        <span>Show Support Centers</span>
      </div>
      
      <button id="resetBtn">Reset</button>
    </div>

    <div class="marker-layer" id="markerLayer"></div>
    
    <div class="tooltip" id="tooltip">
      <h3 id="tooltipTitle"></h3>
      <div class="meta" id="tooltipAddress"></div>
      <div class="badges" id="tooltipBadges"></div>
    </div>
    
    <div class="legend" id="legend"></div>
    
    <div class="stats">
      <div class="stat">
        <div class="stat-value" id="visibleCount">0</div>
        <div class="stat-label">Locations</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="stateCount">0</div>
        <div class="stat-label">States</div>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // SERVICE CENTERS DATA (from JSON - all 67 locations)
    // ============================================
    const serviceCenters = [
      // Support Centers (hidden by default)
      { id: 1, brandName: "Northwest Exterminating", serviceCenter: "Innovation Center", fullAddress: "1728 Montreal Circle Tucker, GA 30084", city: "Tucker", state: "GA", zip: "30084", region: 0, accountingBranchNumber: 6820, services: [], isSupportCenter: true, position: { xPercent: 56, yPercent: 42 } },
      { id: 2, brandName: "Northwest Exterminating", serviceCenter: "Team Support Center", fullAddress: "830 Kennesaw Avenue NW Marietta, GA 30060", city: "Marietta", state: "GA", zip: "30060", region: 0, accountingBranchNumber: 6801, services: [], isSupportCenter: true, position: { xPercent: 50, yPercent: 38 } },
      
      // Region 1 - Alabama/West Georgia
      { id: 3, brandName: "Northwest Exterminating", serviceCenter: "Anniston", fullAddress: "2210 Quintard Ave Anniston, AL 36201", city: "Anniston", state: "AL", zip: "36201", region: 1, accountingBranchNumber: 6837, services: [], isSupportCenter: false, position: { xPercent: 32, yPercent: 32 } },
      { id: 4, brandName: "Northwest Exterminating", serviceCenter: "Carrollton - NWST", fullAddress: "104 Rejen Drive Carrollton, GA 30117", city: "Carrollton", state: "GA", zip: "30117", region: 1, accountingBranchNumber: 6803, services: [], isSupportCenter: false, position: { xPercent: 42, yPercent: 40 } },
      { id: 5, brandName: "Northwest Exterminating", serviceCenter: "Columbus", fullAddress: "1474 Concord Blvd Columbus, GA 31904", city: "Columbus", state: "GA", zip: "31904", region: 1, accountingBranchNumber: 6815, services: [], isSupportCenter: false, position: { xPercent: 40, yPercent: 54 } },
      { id: 6, brandName: "Northwest Exterminating", serviceCenter: "Cullman", fullAddress: "7830 AL-157 Cullman, AL 35057", city: "Cullman", state: "AL", zip: "35057", region: 1, accountingBranchNumber: 6831, services: [], isSupportCenter: false, position: { xPercent: 24, yPercent: 24 } },
      { id: 7, brandName: "Northwest Exterminating", serviceCenter: "Homewood", fullAddress: "240 Oxmoor Cir #104 Birmingham, AL 35209", city: "Birmingham", state: "AL", zip: "35209", region: 1, accountingBranchNumber: 6832, services: [], isSupportCenter: false, position: { xPercent: 26, yPercent: 32 } },
      { id: 8, brandName: "Northwest Exterminating", serviceCenter: "Jasper", fullAddress: "1201 North Airport Road Jasper, AL 35504", city: "Jasper", state: "AL", zip: "35504", region: 1, accountingBranchNumber: 6833, services: [], isSupportCenter: false, position: { xPercent: 22, yPercent: 28 } },
      { id: 9, brandName: "Northwest Exterminating", serviceCenter: "LaGrange", fullAddress: "1005 Hogansville Road LaGrange, GA 30241", city: "LaGrange", state: "GA", zip: "30241", region: 1, accountingBranchNumber: 6814, services: [], isSupportCenter: false, position: { xPercent: 40, yPercent: 48 } },
      { id: 10, brandName: "Northwest Exterminating", serviceCenter: "Newnan", fullAddress: "37 Lakeside Way Newnan, GA 30265", city: "Newnan", state: "GA", zip: "30265", region: 1, accountingBranchNumber: 6810, services: [], isSupportCenter: false, position: { xPercent: 46, yPercent: 46 } },
      { id: 11, brandName: "Northwest Exterminating", serviceCenter: "Opelika", fullAddress: "3600 Pepperell Pkwy Opelika, AL 36801", city: "Opelika", state: "AL", zip: "36801", region: 1, accountingBranchNumber: 6838, services: [], isSupportCenter: false, position: { xPercent: 34, yPercent: 44 } },
      
      // Region 2 - Tennessee/North Carolina
      { id: 12, brandName: "Carolina Pest Management", serviceCenter: "Carolina Pest", fullAddress: "1410 Concord Ave. Monroe, NC 28110", city: "Monroe", state: "NC", zip: "28110", region: 2, accountingBranchNumber: 6835, services: [], isSupportCenter: false, position: { xPercent: 72, yPercent: 14 } },
      { id: 13, brandName: "Northwest Exterminating", serviceCenter: "Hermitage", fullAddress: "3522 Central Pike Suite 211 Hermitage, TN 37076", city: "Hermitage", state: "TN", zip: "37076", region: 2, accountingBranchNumber: 6829, services: [], isSupportCenter: false, position: { xPercent: 26, yPercent: 10 } },
      { id: 14, brandName: "Northwest Exterminating", serviceCenter: "Hixson", fullAddress: "1906 Hamill Road Suite 112 Hixson, TN 37343", city: "Hixson", state: "TN", zip: "37343", region: 2, accountingBranchNumber: 6818, services: [], isSupportCenter: false, position: { xPercent: 36, yPercent: 14 } },
      { id: 15, brandName: "Northwest Exterminating", serviceCenter: "Murfreesboro", fullAddress: "3185 Franklin Road Murfreesboro, TN 37128", city: "Murfreesboro", state: "TN", zip: "37128", region: 2, accountingBranchNumber: 6817, services: [], isSupportCenter: false, position: { xPercent: 24, yPercent: 12 } },
      { id: 16, brandName: "Northwest Exterminating", serviceCenter: "Ooltewah", fullAddress: "8822 Production Lane Suite 104 Ooltewah, TN 37363", city: "Ooltewah", state: "TN", zip: "37363", region: 2, accountingBranchNumber: 6830, services: [], isSupportCenter: false, position: { xPercent: 38, yPercent: 12 } },
      { id: 17, brandName: "Northwest Exterminating", serviceCenter: "Ringgold", fullAddress: "456 Bandy Ln. Ringgold, GA 30736", city: "Ringgold", state: "GA", zip: "30736", region: 2, accountingBranchNumber: 6853, services: [], isSupportCenter: false, position: { xPercent: 40, yPercent: 20 } },
      { id: 18, brandName: "Sawyer Exterminating", serviceCenter: "Sawyer Exterminating", fullAddress: "401 Alamance Rd LOT A Burlington, NC 27215", city: "Burlington", state: "NC", zip: "27215", region: 2, accountingBranchNumber: 6828, services: [], isSupportCenter: false, position: { xPercent: 78, yPercent: 8 } },
      
      // Region 3 - North Georgia / South Carolina
      { id: 19, brandName: "Northwest Exterminating", serviceCenter: "Alpharetta", fullAddress: "193 North Main Street Alpharetta GA 30009", city: "Alpharetta", state: "GA", zip: "30009", region: 3, accountingBranchNumber: 6807, services: [], isSupportCenter: false, position: { xPercent: 54, yPercent: 34 } },
      { id: 20, brandName: "Northwest Exterminating", serviceCenter: "Buford", fullAddress: "929 Buford Hwy NE Buford, GA 30518", city: "Buford", state: "GA", zip: "30518", region: 3, accountingBranchNumber: 6804, services: [], isSupportCenter: false, position: { xPercent: 58, yPercent: 32 } },
      { id: 21, brandName: "Northwest Exterminating", serviceCenter: "Canton", fullAddress: "2649 Marietta Hwy Canton, GA 30114", city: "Canton", state: "GA", zip: "30114", region: 3, accountingBranchNumber: 6809, services: [], isSupportCenter: false, position: { xPercent: 50, yPercent: 30 } },
      { id: 22, brandName: "Northwest Exterminating", serviceCenter: "Dawsonville", fullAddress: "30 Industrial Park Rd #103 Dawsonville, GA 30534", city: "Dawsonville", state: "GA", zip: "30534", region: 3, accountingBranchNumber: null, services: [], isSupportCenter: false, position: { xPercent: 52, yPercent: 26 } },
      { id: 23, brandName: "Northwest Exterminating", serviceCenter: "Gainesville, GA", fullAddress: "1011 Airport St. Gainesville, GA 30501", city: "Gainesville", state: "GA", zip: "30501", region: 3, accountingBranchNumber: 6827, services: [], isSupportCenter: false, position: { xPercent: 56, yPercent: 28 } },
      { id: 24, brandName: "Northwest Exterminating", serviceCenter: "Lanier", fullAddress: "6715 Little Mill Rd Cumming, GA 30041", city: "Cumming", state: "GA", zip: "30041", region: 3, accountingBranchNumber: 6813, services: [], isSupportCenter: false, position: { xPercent: 54, yPercent: 30 } },
      { id: 25, brandName: "Northwest Exterminating", serviceCenter: "Laurens", fullAddress: "600 North Harper Street Laurens, SC 29360", city: "Laurens", state: "SC", zip: "29360", region: 3, accountingBranchNumber: 6824, services: [], isSupportCenter: false, position: { xPercent: 68, yPercent: 24 } },
      { id: 26, brandName: "Northwest Exterminating", serviceCenter: "Lithia Springs", fullAddress: "685 Thornton Way Suite C and D Lithia Springs, GA 30122", city: "Lithia Springs", state: "GA", zip: "30122", region: 3, accountingBranchNumber: null, services: [], isSupportCenter: false, position: { xPercent: 48, yPercent: 42 } },
      { id: 27, brandName: "Northwest Exterminating", serviceCenter: "Peachtree Corners", fullAddress: "3158 Process Dr NW Norcross, GA 30071", city: "Norcross", state: "GA", zip: "30071", region: 3, accountingBranchNumber: 6821, services: [], isSupportCenter: false, position: { xPercent: 56, yPercent: 38 } },
      
      // Region 4 - Central/East Georgia
      { id: 28, brandName: "Northwest Exterminating", serviceCenter: "Augusta - NWST", fullAddress: "4820 Technology Dr. Suite B. Martinez, GA 30907", city: "Martinez", state: "GA", zip: "30907", region: 4, accountingBranchNumber: 6822, services: [], isSupportCenter: false, position: { xPercent: 70, yPercent: 38 } },
      { id: 29, brandName: "Northwest Exterminating", serviceCenter: "Lawrenceville", fullAddress: "2870 Sugarloaf Parkway Lawrenceville, GA 30045", city: "Lawrenceville", state: "GA", zip: "30045", region: 4, accountingBranchNumber: 6805, services: [], isSupportCenter: false, position: { xPercent: 58, yPercent: 40 } },
      { id: 30, brandName: "Northwest Exterminating", serviceCenter: "Macon - NWST", fullAddress: "4549 Knight Road Macon, GA 31220", city: "Macon", state: "GA", zip: "31220", region: 4, accountingBranchNumber: 6826, services: [], isSupportCenter: false, position: { xPercent: 54, yPercent: 54 } },
      { id: 31, brandName: "Northwest Exterminating", serviceCenter: "Monroe, GA - NWST", fullAddress: "2014 Highway 78 Monroe, GA 30655", city: "Monroe", state: "GA", zip: "30655", region: 4, accountingBranchNumber: 6811, services: [], isSupportCenter: false, position: { xPercent: 60, yPercent: 42 } },
      { id: 32, brandName: "Northwest Exterminating", serviceCenter: "Savannah", fullAddress: "124 US-80 Pooler, GA 31322", city: "Pooler", state: "GA", zip: "31322", region: 4, accountingBranchNumber: 6812, services: [], isSupportCenter: false, position: { xPercent: 76, yPercent: 52 } },
      { id: 33, brandName: "Northwest Exterminating", serviceCenter: "Stockbridge", fullAddress: "105 Andrew Dr. Suite 500 Stockbridge, GA 30281", city: "Stockbridge", state: "GA", zip: "30281", region: 4, accountingBranchNumber: 6806, services: [], isSupportCenter: false, position: { xPercent: 54, yPercent: 46 } },
      
      // Region 5 - Metro Atlanta
      { id: 34, brandName: "Northwest Exterminating", serviceCenter: "Acworth", fullAddress: "3650 New McEver Rd NW Acworth, GA 30101", city: "Acworth", state: "GA", zip: "30101", region: 5, accountingBranchNumber: 6819, services: [], isSupportCenter: false, position: { xPercent: 48, yPercent: 32 } },
      { id: 35, brandName: "Northwest Exterminating", serviceCenter: "Dallas", fullAddress: "1003 Merchants Drive Dallas, GA 30132", city: "Dallas", state: "GA", zip: "30132", region: 5, accountingBranchNumber: 6808, services: [], isSupportCenter: false, position: { xPercent: 44, yPercent: 34 } },
      { id: 36, brandName: "Northwest Exterminating", serviceCenter: "East Cobb", fullAddress: "670 Powers Ferry Road Marietta, GA 30067", city: "Marietta", state: "GA", zip: "30067", region: 5, accountingBranchNumber: 6816, services: [], isSupportCenter: false, position: { xPercent: 51, yPercent: 37 } },
      { id: 37, brandName: "Northwest Exterminating", serviceCenter: "Marietta", fullAddress: "1004 Kenmill Drive Dr NW Marietta, GA 30060", city: "Marietta", state: "GA", zip: "30060", region: 5, accountingBranchNumber: 6825, services: [], isSupportCenter: false, position: { xPercent: 49, yPercent: 36 } },
      { id: 38, brandName: "Northwest Exterminating", serviceCenter: "Smyrna", fullAddress: "1740 Corn Road Smyrna, GA 30080", city: "Smyrna", state: "GA", zip: "30080", region: 5, accountingBranchNumber: 6802, services: [], isSupportCenter: false, position: { xPercent: 50, yPercent: 40 } },
      { id: 39, brandName: "Northwest Exterminating", serviceCenter: "Tucker", fullAddress: "1724 Montreal Circle Tucker, GA 30084", city: "Tucker", state: "GA", zip: "30084", region: 5, accountingBranchNumber: 6820, services: [], isSupportCenter: false, position: { xPercent: 55, yPercent: 42 } },
      
      // Region 7 - Bug House Pest Control
      { id: 40, brandName: "Bug House Pest Control", serviceCenter: "Augusta - Bug House", fullAddress: "655 NW Frontage Rd Augusta, GA 30907", city: "Augusta", state: "GA", zip: "30907", region: 7, accountingBranchNumber: 9609, services: [], isSupportCenter: false, position: { xPercent: 71, yPercent: 40 } },
      { id: 41, brandName: "Bug House Pest Control", serviceCenter: "Carrollton - Bug House", fullAddress: "215 Bankhead Hwy Carrollton, GA 30117", city: "Carrollton", state: "GA", zip: "30117", region: 7, accountingBranchNumber: 9605, services: [], isSupportCenter: false, position: { xPercent: 41, yPercent: 42 } },
      { id: 42, brandName: "Bug House Pest Control", serviceCenter: "Dublin", fullAddress: "1022 Hillcrest Pkwy #108 Dublin, GA 31021", city: "Dublin", state: "GA", zip: "31021", region: 7, accountingBranchNumber: 9613, services: [], isSupportCenter: false, position: { xPercent: 60, yPercent: 58 } },
      { id: 43, brandName: "Bug House Pest Control", serviceCenter: "Eastman", fullAddress: "219 College Street Eastman, GA 31023", city: "Eastman", state: "GA", zip: "31023", region: 7, accountingBranchNumber: 9614, services: [], isSupportCenter: false, position: { xPercent: 58, yPercent: 60 } },
      { id: 44, brandName: "Bug House Pest Control", serviceCenter: "Greensboro", fullAddress: "1210 Commerce Dr STE 101 Greensboro, GA 30642", city: "Greensboro", state: "GA", zip: "30642", region: 7, accountingBranchNumber: 9608, services: [], isSupportCenter: false, position: { xPercent: 62, yPercent: 46 } },
      { id: 45, brandName: "Bug House Pest Control", serviceCenter: "Macon - Bug House", fullAddress: "3663 Vineville Ave Macon, GA 31204", city: "Macon", state: "GA", zip: "31204", region: 7, accountingBranchNumber: 9603, services: [], isSupportCenter: false, position: { xPercent: 53, yPercent: 56 } },
      { id: 46, brandName: "Bug House Pest Control", serviceCenter: "Madison", fullAddress: "1165 Eatonton Rd Madison, GA 30650", city: "Madison", state: "GA", zip: "30650", region: 7, accountingBranchNumber: 9610, services: [], isSupportCenter: false, position: { xPercent: 60, yPercent: 48 } },
      { id: 47, brandName: "Bug House Pest Control", serviceCenter: "Milledgeville", fullAddress: "1511 North Columbia St. Milledgeville, GA 31061", city: "Milledgeville", state: "GA", zip: "31061", region: 7, accountingBranchNumber: 9601, services: [], isSupportCenter: false, position: { xPercent: 58, yPercent: 52 } },
      { id: 48, brandName: "Bug House Pest Control", serviceCenter: "St. Simons - Bug House", fullAddress: "3 Retreat Pl St. Simons Island, GA 31522", city: "St. Simons Island", state: "GA", zip: "31522", region: 7, accountingBranchNumber: 9602, services: [], isSupportCenter: false, position: { xPercent: 78, yPercent: 64 } },
      { id: 49, brandName: "Bug House Pest Control", serviceCenter: "Warner Robins - Bug House", fullAddress: "618C Houston Lake Blvd Centerville, GA 31028", city: "Centerville", state: "GA", zip: "31028", region: 7, accountingBranchNumber: 9604, services: [], isSupportCenter: false, position: { xPercent: 52, yPercent: 58 } },
      { id: 50, brandName: "Bug House Pest Control", serviceCenter: "Watkinsville - Bug House", fullAddress: "1021 Industrial Blvd Suite B. Watkinsville, GA 30677", city: "Watkinsville", state: "GA", zip: "30677", region: 7, accountingBranchNumber: 9612, services: [], isSupportCenter: false, position: { xPercent: 62, yPercent: 44 } },
      
      // Region 10 - Commercial Pest
      { id: 51, brandName: "Northwest Exterminating", serviceCenter: "Commercial Pest - East Cobb", fullAddress: "670 Powers Ferry Road Marietta, GA 30067", city: "Marietta", state: "GA", zip: "30067", region: 10, accountingBranchNumber: 6860, services: [], isSupportCenter: false, note: "Commercial", position: { xPercent: 52, yPercent: 38 } },
      { id: 52, brandName: "Northwest Exterminating", serviceCenter: "Commercial Pest - Lithia Springs", fullAddress: "685 Thornton Way Suite C and D Lithia Springs, GA 30122", city: "Lithia Springs", state: "GA", zip: "30122", region: 10, accountingBranchNumber: null, services: [], isSupportCenter: false, note: "Commercial", position: { xPercent: 47, yPercent: 44 } },
      { id: 53, brandName: "Northwest Exterminating", serviceCenter: "Commercial Pest - Tucker", fullAddress: "1724 Montreal Circle Tucker, GA 30084", city: "Tucker", state: "GA", zip: "30084", region: 10, accountingBranchNumber: 6861, services: [], isSupportCenter: false, note: "Commercial", position: { xPercent: 57, yPercent: 42 } },
      
      // Region 11 - McCall Pest and Wildlife (North Florida)
      { id: 54, brandName: "McCall Pest and Wildlife", serviceCenter: "Gainesville, FL", fullAddress: "415 NW 250th St #1 Newberry, FL 32669", city: "Newberry", state: "FL", zip: "32669", region: 11, accountingBranchNumber: 6875, services: [], isSupportCenter: false, position: { xPercent: 60, yPercent: 76 } },
      { id: 55, brandName: "McCall Pest and Wildlife", serviceCenter: "Jacksonville", fullAddress: "2861 College St Jacksonville, FL 32205", city: "Jacksonville", state: "FL", zip: "32205", region: 11, accountingBranchNumber: 6872, services: [], isSupportCenter: false, position: { xPercent: 74, yPercent: 70 } },
      { id: 56, brandName: "McCall Pest and Wildlife", serviceCenter: "Ocala", fullAddress: "35 SE 1st Ave. STE 200 Office C. Ocala, FL 34475", city: "Ocala", state: "FL", zip: "34475", region: 11, accountingBranchNumber: 6874, services: [], isSupportCenter: false, position: { xPercent: 66, yPercent: 80 } },
      { id: 57, brandName: "McCall Pest and Wildlife", serviceCenter: "Orlando", fullAddress: "5892 S Semoran Blvd Building B. Orlando, FL 32822", city: "Orlando", state: "FL", zip: "32822", region: 11, accountingBranchNumber: 6882, services: [], isSupportCenter: false, position: { xPercent: 74, yPercent: 84 } },
      { id: 58, brandName: "McCall Pest and Wildlife", serviceCenter: "Tallahassee", fullAddress: "5149 Woodlane Cir. Tallahassee, FL 32303", city: "Tallahassee", state: "FL", zip: "32303", region: 11, accountingBranchNumber: 6873, services: [], isSupportCenter: false, position: { xPercent: 48, yPercent: 72 } },
      { id: 59, brandName: "McCall Pest and Wildlife", serviceCenter: "Tampa", fullAddress: "2610 Tampa E. Blvd Tampa, FL 33619", city: "Tampa", state: "FL", zip: "33619", region: 11, accountingBranchNumber: 6876, services: [], isSupportCenter: false, position: { xPercent: 66, yPercent: 88 } },
      
      // Region 12 - South Florida
      { id: 60, brandName: "Northwest Exterminating", serviceCenter: "Bonita Springs", fullAddress: "9200 Cockleshell Ct. Bonita Springs, FL 34135", city: "Bonita Springs", state: "FL", zip: "34135", region: 12, accountingBranchNumber: 6841, services: [], isSupportCenter: false, note: "West Coast", position: { xPercent: 70, yPercent: 92 } },
      { id: 61, brandName: "Northwest Exterminating", serviceCenter: "Broward", fullAddress: "5580 N Pine Island Rd. Lauderhill, FL 33351", city: "Lauderhill", state: "FL", zip: "33351", region: 12, accountingBranchNumber: 6843, services: [], isSupportCenter: false, note: "East Coast", position: { xPercent: 82, yPercent: 94 } },
      { id: 62, brandName: "Northwest Exterminating", serviceCenter: "Doral", fullAddress: "1529 NW 89th Court Doral, FL 33172", city: "Doral", state: "FL", zip: "33172", region: 12, accountingBranchNumber: 6844, services: [], isSupportCenter: false, note: "East Coast", position: { xPercent: 80, yPercent: 96 } },
      { id: 63, brandName: "Northwest Exterminating", serviceCenter: "Fort Myers", fullAddress: "13901 N Cleveland Ave. Fort Myers FL, 33903", city: "Fort Myers", state: "FL", zip: "33903", region: 12, accountingBranchNumber: 6842, services: [], isSupportCenter: false, note: "West Coast", position: { xPercent: 68, yPercent: 90 } },
      { id: 64, brandName: "Northwest Exterminating", serviceCenter: "Miami Gardens", fullAddress: "17401 NW 2nd Ave #1 Miami, FL 33169", city: "Miami", state: "FL", zip: "33169", region: 12, accountingBranchNumber: 6845, services: [], isSupportCenter: false, note: "East Coast", position: { xPercent: 81, yPercent: 95 } },
      { id: 65, brandName: "Northwest Exterminating", serviceCenter: "Naples", fullAddress: "10550 Collier Blvd Naples, FL 34116", city: "Naples", state: "FL", zip: "34116", region: 12, accountingBranchNumber: 6846, services: [], isSupportCenter: false, note: "West Coast", position: { xPercent: 69, yPercent: 93 } },
      { id: 66, brandName: "Northwest Exterminating", serviceCenter: "Pompano Beach", fullAddress: "2420 N Andrews Ave Ext Pompano Beach, FL 33064", city: "Pompano Beach", state: "FL", zip: "33069", region: 12, accountingBranchNumber: 6847, services: [], isSupportCenter: false, note: "East Coast", position: { xPercent: 83, yPercent: 93 } },
      
      // Volunteer Rid-A-Pest (Tennessee)
      { id: 67, brandName: "Volunteer Rid-A-Pest", serviceCenter: "Volunteer Rid-A-Pest", fullAddress: "633 Mimosa Dr NW, Cleveland, TN 37312", city: "Cleveland", state: "TN", zip: "37312", region: null, accountingBranchNumber: null, services: [], isSupportCenter: false, position: { xPercent: 37, yPercent: 16 } },
    ];

    // Brand info for legend and colors
    const brands = [
      { name: "Northwest Exterminating", className: "Northwest_Exterminating" },
      { name: "Carolina Pest Management", className: "Carolina_Pest_Management" },
      { name: "Sawyer Exterminating", className: "Sawyer_Exterminating" },
      { name: "Bug House Pest Control", className: "Bug_House_Pest_Control" },
      { name: "McCall Pest and Wildlife", className: "McCall_Pest_and_Wildlife" },
      { name: "Volunteer Rid-A-Pest", className: "Volunteer_Rid_A_Pest" },
    ];

    // ============================================
    // APPLICATION STATE & ELEMENTS
    // ============================================
    const elements = {
      markerLayer: document.getElementById('markerLayer'),
      tooltip: document.getElementById('tooltip'),
      tooltipTitle: document.getElementById('tooltipTitle'),
      tooltipAddress: document.getElementById('tooltipAddress'),
      tooltipBadges: document.getElementById('tooltipBadges'),
      searchCenter: document.getElementById('searchCenter'),
      suggestions: document.getElementById('suggestions'),
      stateFilter: document.getElementById('stateFilter'),
      toggleSupport: document.getElementById('toggleSupport'),
      resetBtn: document.getElementById('resetBtn'),
      visibleCount: document.getElementById('visibleCount'),
      stateCount: document.getElementById('stateCount'),
      legend: document.getElementById('legend')
    };

    let state = {
      searchQuery: '',
      selectedState: '',
      showSupportCenters: false,
      highlightedId: null,
      suggestionIndex: -1
    };

    // ============================================
    // HELPER FUNCTIONS
    // ============================================
    function getBrandClassName(brandName) {
      return brandName.replace(/\s+/g, '_').replace(/[^a-zA-Z0-9_]/g, '');
    }

    function getFilteredCenters() {
      return serviceCenters.filter(center => {
        // Support center filter
        if (center.isSupportCenter && !state.showSupportCenters) return false;
        
        // State filter
        if (state.selectedState && center.state !== state.selectedState) return false;
        
        // Search filter
        if (state.searchQuery) {
          const query = state.searchQuery.toLowerCase();
          const matchesName = center.serviceCenter.toLowerCase().includes(query);
          const matchesCity = center.city.toLowerCase().includes(query);
          const matchesBrand = center.brandName.toLowerCase().includes(query);
          if (!matchesName && !matchesCity && !matchesBrand) return false;
        }
        
        return true;
      });
    }

    // ============================================
    // INITIALIZATION
    // ============================================
    function init() {
      populateStateFilter();
      renderLegend();
      renderMarkers();
      setupEventListeners();
      updateStats();
    }

    function populateStateFilter() {
      const states = [...new Set(serviceCenters.map(sc => sc.state))].sort();
      states.forEach(st => {
        const option = document.createElement('option');
        option.value = st;
        option.textContent = st;
        elements.stateFilter.appendChild(option);
      });
    }

    function renderLegend() {
      // Get brands that have at least one visible center
      const visibleBrands = new Set(serviceCenters.map(c => c.brandName));
      
      elements.legend.innerHTML = brands
        .filter(brand => visibleBrands.has(brand.name))
        .map(brand => `
          <div class="legend-item" data-brand="${brand.name}">
            <div class="legend-swatch brand--${brand.className}"></div>
            <span>${brand.name}</span>
          </div>
        `).join('');
      
      // Add click handlers to legend items
      elements.legend.querySelectorAll('.legend-item').forEach(item => {
        item.addEventListener('click', () => {
          const brandName = item.dataset.brand;
          elements.searchCenter.value = brandName;
          state.searchQuery = brandName;
          renderMarkers();
          updateStats();
          hideSuggestions();
        });
      });
    }

    // ============================================
    // RENDERING
    // ============================================
    function renderMarkers() {
      elements.markerLayer.innerHTML = '';
      
      const filteredCenters = getFilteredCenters();
      const allCenters = serviceCenters.filter(c => 
        c.isSupportCenter ? state.showSupportCenters : true
      );
      
      allCenters.forEach(center => {
        const marker = document.createElement('div');
        const brandClass = `brand--${getBrandClassName(center.brandName)}`;
        const isFiltered = filteredCenters.some(fc => fc.id === center.id);
        const isHighlighted = state.highlightedId === center.id;
        
        marker.className = `marker ${brandClass}${!isFiltered ? ' is-dim' : ''}${isHighlighted ? ' is-highlighted is-active' : ''}`;
        marker.setAttribute('tabindex', isFiltered ? '0' : '-1');
        marker.setAttribute('role', 'button');
        marker.setAttribute('aria-label', `${center.serviceCenter}, ${center.city}, ${center.state}`);
        marker.dataset.id = center.id;
        
        // Position marker
        marker.style.left = `${center.position.xPercent}%`;
        marker.style.top = `${center.position.yPercent}%`;
        
        // Event listeners
        marker.addEventListener('mouseenter', (e) => showTooltip(center, e));
        marker.addEventListener('mouseleave', hideTooltip);
        marker.addEventListener('focus', (e) => showTooltip(center, e));
        marker.addEventListener('blur', hideTooltip);
        marker.addEventListener('click', () => {
          state.highlightedId = state.highlightedId === center.id ? null : center.id;
          renderMarkers();
        });
        
        elements.markerLayer.appendChild(marker);
      });
    }

    // ============================================
    // TOOLTIP
    // ============================================
    function showTooltip(center, event) {
      const brandClass = getBrandClassName(center.brandName);
      
      elements.tooltipTitle.textContent = center.serviceCenter;
      elements.tooltipAddress.innerHTML = `
        ${center.fullAddress}<br>
        <span style="opacity: 0.7; font-size: 11px; margin-top: 4px; display: block;">
          Region ${center.region || 'N/A'} ${center.accountingBranchNumber ? `• Branch #${center.accountingBranchNumber}` : ''}
        </span>
      `;
      
      // Build badges
      let badgesHTML = `<span class="badge brand ${brandClass}">${center.brandName}</span>`;
      if (center.isSupportCenter) {
        badgesHTML += `<span class="badge" style="border-color: #60a5fa; color: #60a5fa;">Support Center</span>`;
      }
      if (center.note) {
        badgesHTML += `<span class="badge" style="opacity: 0.7;">${center.note}</span>`;
      }
      elements.tooltipBadges.innerHTML = badgesHTML;
      
      // Position tooltip
      const marker = event.target;
      const rect = marker.getBoundingClientRect();
      const mapRect = elements.markerLayer.getBoundingClientRect();
      
      let left = rect.left - mapRect.left + 20;
      let top = rect.top - mapRect.top - 10;
      
      // Adjust if tooltip would go off-screen
      const tooltipWidth = 300;
      const tooltipHeight = 150;
      
      if (left + tooltipWidth > mapRect.width) {
        left = rect.left - mapRect.left - tooltipWidth - 10;
      }
      if (top + tooltipHeight > mapRect.height) {
        top = mapRect.height - tooltipHeight - 20;
      }
      if (top < 80) { // Below controls
        top = 80;
      }
      
      elements.tooltip.style.left = `${left}px`;
      elements.tooltip.style.top = `${top}px`;
      elements.tooltip.classList.add('is-open');
    }

    function hideTooltip() {
      elements.tooltip.classList.remove('is-open');
    }

    // ============================================
    // SEARCH & SUGGESTIONS
    // ============================================
    function showSuggestions(query) {
      if (!query) {
        hideSuggestions();
        return;
      }
      
      const q = query.toLowerCase();
      const matches = serviceCenters
        .filter(c => {
          if (c.isSupportCenter && !state.showSupportCenters) return false;
          return c.serviceCenter.toLowerCase().includes(q) ||
                 c.city.toLowerCase().includes(q) ||
                 c.brandName.toLowerCase().includes(q);
        })
        .slice(0, 8);
      
      if (matches.length === 0) {
        elements.suggestions.innerHTML = '<div class="suggestion-item" style="pointer-events: none; opacity: 0.5;">No matches found</div>';
        elements.suggestions.classList.add('active');
        return;
      }
      
      elements.suggestions.innerHTML = matches.map((center, idx) => {
        const brandClass = getBrandClassName(center.brandName);
        return `
          <div class="suggestion-item${idx === state.suggestionIndex ? ' selected' : ''}" data-id="${center.id}">
            <span>${center.serviceCenter} <span style="opacity: 0.6; font-size: 11px;">${center.city}, ${center.state}</span></span>
            <span class="brand-tag ${brandClass}">${center.brandName.split(' ')[0]}</span>
          </div>
        `;
      }).join('');
      
      elements.suggestions.classList.add('active');
      
      // Add click handlers
      elements.suggestions.querySelectorAll('.suggestion-item[data-id]').forEach(item => {
        item.addEventListener('click', () => {
          const id = parseInt(item.dataset.id);
          selectSuggestion(id);
        });
      });
    }

    function hideSuggestions() {
      elements.suggestions.classList.remove('active');
      state.suggestionIndex = -1;
    }

    function selectSuggestion(id) {
      const center = serviceCenters.find(c => c.id === id);
      if (center) {
        elements.searchCenter.value = center.serviceCenter;
        state.searchQuery = center.serviceCenter;
        state.highlightedId = id;
        renderMarkers();
        updateStats();
        hideSuggestions();
        
        // Focus on the marker
        const marker = elements.markerLayer.querySelector(`[data-id="${id}"]`);
        if (marker) marker.focus();
      }
    }

    // ============================================
    // STATS
    // ============================================
    function updateStats() {
      const filtered = getFilteredCenters();
      const states = new Set(filtered.map(c => c.state));
      
      elements.visibleCount.textContent = filtered.length;
      elements.stateCount.textContent = states.size;
    }

    // ============================================
    // EVENT LISTENERS
    // ============================================
    function setupEventListeners() {
      // Search input
      elements.searchCenter.addEventListener('input', (e) => {
        state.searchQuery = e.target.value;
        state.suggestionIndex = -1;
        showSuggestions(e.target.value);
        renderMarkers();
        updateStats();
      });
      
      elements.searchCenter.addEventListener('focus', () => {
        if (elements.searchCenter.value) {
          showSuggestions(elements.searchCenter.value);
        }
      });
      
      // Keyboard navigation
      elements.searchCenter.addEventListener('keydown', (e) => {
        const items = elements.suggestions.querySelectorAll('.suggestion-item[data-id]');
        
        if (e.key === 'ArrowDown') {
          e.preventDefault();
          state.suggestionIndex = Math.min(state.suggestionIndex + 1, items.length - 1);
          updateSuggestionHighlight(items);
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          state.suggestionIndex = Math.max(state.suggestionIndex - 1, 0);
          updateSuggestionHighlight(items);
        } else if (e.key === 'Enter' && state.suggestionIndex >= 0) {
          e.preventDefault();
          const item = items[state.suggestionIndex];
          if (item) selectSuggestion(parseInt(item.dataset.id));
        } else if (e.key === 'Escape') {
          hideSuggestions();
        }
      });
      
      // Click outside to close suggestions
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-wrapper')) {
          hideSuggestions();
        }
      });
      
      // State filter
      elements.stateFilter.addEventListener('change', (e) => {
        state.selectedState = e.target.value;
        state.highlightedId = null;
        renderMarkers();
        updateStats();
      });
      
      // Toggle support centers
      elements.toggleSupport.addEventListener('change', (e) => {
        state.showSupportCenters = e.target.checked;
        renderMarkers();
        updateStats();
      });
      
      // Reset button
      elements.resetBtn.addEventListener('click', () => {
        state.searchQuery = '';
        state.selectedState = '';
        state.showSupportCenters = false;
        state.highlightedId = null;
        
        elements.searchCenter.value = '';
        elements.stateFilter.value = '';
        elements.toggleSupport.checked = false;
        
        hideSuggestions();
        renderMarkers();
        updateStats();
      });
    }

    function updateSuggestionHighlight(items) {
      items.forEach((item, idx) => {
        item.classList.toggle('selected', idx === state.suggestionIndex);
      });
    }

    // ============================================
    // POSITION HELPER (for debugging/adjusting)
    // ============================================
    window.updatePosition = function(id, xPercent, yPercent) {
      const center = serviceCenters.find(c => c.id === id);
      if (center) {
        center.position.xPercent = xPercent;
        center.position.yPercent = yPercent;
        renderMarkers();
        console.log(`Updated ${center.serviceCenter}: x=${xPercent}%, y=${yPercent}%`);
      }
    };

    // Initialize
    init();
  </script>
</body>
</html>
